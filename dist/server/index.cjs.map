{"version":3,"file":"index.cjs.js","mappings":";;;;;;;AAAA;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BA;AACA;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["../external node-commonjs \"fs\"","../external node-commonjs \"http\"","../external node-commonjs \"https\"","../webpack/bootstrap","../webpack/runtime/compat",".././src/server.cjs"],"sourcesContent":["module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"https\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","const http = require(\"http\");\r\nconst https = require(\"https\");\r\nconst fs = require(\"fs\");\r\n\r\n\r\nconst PORT_HTTPS = 5710;\r\nconst PORT_HTTP = 5711;\r\n\r\n\r\nclass Deferred {\r\n    constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n}\r\n\r\n\r\nconst options = {\r\n    key: null,\r\n    cert: null,\r\n};\r\ntry {\r\n    options.key = fs.readFileSync(\"key.pem\");\r\n    options.cert = fs.readFileSync(\"cert.pem\");\r\n} catch (e) {\r\n    console.log(\"no sert\");\r\n}\r\n\r\nconst ALLOWED_ORIGINS = [\r\n    \"http://localhost:3000\",\r\n    \"https://maxislav.github.io\",\r\n    \"https://another-site.net\",\r\n];\r\n\r\nlet cookie;\r\n\r\nconst serverHttps = https.createServer(options, async (reqq, ress) => {\r\n    const origin = reqq.headers.origin || reqq.headers.referer;\r\n\r\n    console.log(\"origin ->>\", origin);\r\n    if (ALLOWED_ORIGINS.includes(origin)) {\r\n        ress.setHeader(\"Access-Control-Allow-Origin\", origin);\r\n    }\r\n    ress.setHeader(\"Access-Control-Allow-Methods\", \"GET, OPTIONS\");\r\n    ress.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type\");\r\n    // Проверяем путь запроса\r\n    if (reqq.url === \"/shutdown\" && reqq.method === \"GET\") {\r\n        try {\r\n            const data = await myRequest();\r\n            ress.end(data);\r\n        } catch (error) {\r\n            console.error(\"Ошибка при запросе:\", error);\r\n            ress.end(error);\r\n        }\r\n    } else {\r\n        // Обработка несуществующих путей\r\n        ress.writeHead(404, {\"Content-Type\": \"text/plain\"});\r\n        ress.end(\"Not Found. Use /shutdown\");\r\n    }\r\n});\r\n\r\nconst serverHttp = http.createServer(async (reqq, ress) => {\r\n    const origin = reqq.headers.origin;\r\n\r\n\r\n    if (reqq.url === \"/shutdown\" && reqq.method === \"GET\") {\r\n        try {\r\n            const data = await myRequest();\r\n            ress.end(data);\r\n        } catch (error) {\r\n            console.error(\"Ошибка при запросе:\", error);\r\n            ress.end(error);\r\n        }\r\n    } else {\r\n        // Обработка несуществующих путей\r\n        ress.writeHead(404, {\"Content-Type\": \"text/plain\"});\r\n        ress.end(\"Not Found. Use /shutdown\");\r\n    }\r\n\r\n});\r\n\r\n\r\nserverHttp.listen(PORT_HTTP, () => {\r\n    console.log(`Сервер запущен на https://localhost:${PORT_HTTP}`);\r\n    console.log(`Маршрут: https://localhost:${PORT_HTTP}/shutdown`);\r\n});\r\n\r\nif (options.cert) {\r\n    serverHttps.listen(PORT_HTTPS, () => {\r\n        console.log(`Сервер запущен на https://localhost:${PORT_HTTPS}`);\r\n        console.log(`Маршрут: https://localhost:${PORT_HTTPS}/shutdown`);\r\n    });\r\n}\r\n\r\nfunction extractFactObject(html) {\r\n    const startKeyword = \"DisconSchedule.fact = \";\r\n    const startIndex = html.indexOf(startKeyword);\r\n\r\n    if (startIndex === -1) return null;\r\n\r\n    // Смещение к началу самого объекта (к первой '{')\r\n    const jsonStartIndex = html.indexOf(\"{\", startIndex);\r\n    if (jsonStartIndex === -1) return null;\r\n\r\n    let braceCount = 0;\r\n    let jsonEndIndex = -1;\r\n\r\n    // Идем по строке и считаем скобки\r\n    for (let i = jsonStartIndex; i < html.length; i++) {\r\n        if (html[i] === \"{\") braceCount++;\r\n        if (html[i] === \"}\") braceCount--;\r\n\r\n        if (braceCount === 0) {\r\n            jsonEndIndex = i + 1; // Конец объекта найден\r\n            break;\r\n        }\r\n    }\r\n\r\n    return html.substring(jsonStartIndex, jsonEndIndex);\r\n}\r\n\r\n\r\n\r\nasync function myRequest() {\r\n\r\n    const deferred = new Deferred();\r\n\r\n    const options = {\r\n        hostname: 'app.yasno.ua',\r\n        path: '/api/blackout-service/public/shutdowns/regions/25/dsos/902/planned-outages',\r\n        port: 443,\r\n        method: 'GET',\r\n        headers: {\r\n            'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',\r\n            'accept-language': 'en-US,en;q=0.9,ru-UA;q=0.8,ru;q=0.7',\r\n            'cache-control': 'no-cache',\r\n            // _language=1f011804d107a9f0f6fa36417ed49140e5bc2106c740e65666f3a94e857201cca%3A2%3A%7Bi%3A0%3Bs%3A9%3A%22_language%22%3Bi%3A1%3Bs%3A2%3A%22uk%22%3B%7D; Domain=dtek-kem.com.ua; incap_wrt_373=l4ZXaQAAAAAVyqQeGgAI9QIQ19KJ+IoCGMOP3soGIAIol43eygYwAcI97KunruIFdFbLUVxCTvE=\r\n            // 'cookie': 'Domain=dtek-kem.com.ua; _language=1f011804d107a9f0f6fa36417ed49140e5bc2106c740e65666f3a94e857201cca%3A2%3A%7Bi%3A0%3Bs%3A9%3A%22_language%22%3Bi%3A1%3Bs%3A2%3A%22uk%22%3B%7D; _csrf-dtek-kem=c8f39373a7774952fd97b02a7f43cc2ac9e324e318f7dcc772d7a8a0e3bad787a%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-dtek-kem%22%3Bi%3A1%3Bs%3A32%3A%22V34z7YvlMC38q_x6V5lmODnzaXzxYN2z%22%3B%7D; incap_ses_608_2224657=ADCQBtph4nMECpJR2gxwCAV2V2kAAAAATsGxAx1IHVBJ0E9pvJaz7g==; _gid=GA1.3.687185050.1767339528; _hjSession_5026684=eyJpZCI6ImVjYmE4YzgyLTdhNzAtNDcxYS1iYTdhLWI0MzUyNWY4NGYxYSIsImMiOjE3NjczMzk1Mjc5MjIsInMiOjAsInIiOjAsInNiIjowLCJzciI6MCwic2UiOjAsImZzIjoxLCJzcCI6MX0=; incap_ses_689_2224657=7JGtWNRVzk0+GqurS9KPCY95V2kAAAAA9FA8iYF/1+dyneFu2VNTZg==; _hjSessionUser_5026684=eyJpZCI6IjkyZGE5NjI4LWU2OWUtNTY2My04MjRhLTU5OTJiM2U3N2E4MSIsImNyZWF0ZWQiOjE3NjczMzk1Mjc5MjEsImV4aXN0aW5nIjp0cnVlfQ==; Domain=dtek-kem.com.ua; dtek-kem=ijdn71j2j7rd07kohj08qh9mqu; incap_ses_184_2224657=7F3zcUdr/jQaiWOyarONAgOBV2kAAAAA3BzxLegvPYebi1yzRDb7oA==; visid_incap_2224657=I2r5ysVoStilW4lHadL7AQV2V2kAAAAAQkIPAAAAAACAWXXBAVXf0RLLatMOoJcvJXZOhO7X2G5m; _ga_DLFSTRRPM2=GS2.1.s1767339527$o1$g1$t1767342346$j55$l0$h0; _ga=GA1.3.793052785.1767339528; _gat_gtag_UA_121351636_1=1; incap_wrt_373=CYFXaQAAAAASnJYnGgAI9QIQ/bzm9ooCGLWE3soGIAIohYLeygYwASsTGroGYIlb8Cl66SYX3nk=',\r\n            //'cookie': '_language=1f011804d107a9f0f6fa36417ed49140e5bc2106c740e65666f3a94e857201cca%3A2%3A%7Bi%3A0%3Bs%3A9%3A%22_language%22%3Bi%3A1%3Bs%3A2%3A%22uk%22%3B%7D; incap_wrt_373=DYFXaQAAAAC4zvQ5GgAI9QIQ/bzm9ooCGLmE3soGIAIohYLeygYwARBZGNX0CeGPiUR1Cf2fBZU=',\r\n            'pragma': 'no-cache',\r\n            'priority': 'u=0, i',\r\n            'sec-ch-ua': '\"Google Chrome\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"',\r\n            'sec-ch-ua-mobile': '?0',\r\n            'sec-ch-ua-platform': '\"Windows\"',\r\n            'sec-fetch-dest': 'document',\r\n            'sec-fetch-mode': 'navigate',\r\n            'sec-fetch-site': 'none',\r\n            'sec-fetch-user': '?1',\r\n            'upgrade-insecure-requests': '1',\r\n            'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36'\r\n        }\r\n    };\r\n\r\n    https.get(options, (res) => {\r\n        let data = '';\r\n        const headers = res.headers;\r\n        console.log('Set-Cookie:', headers['set-cookie']);\r\n\r\n\r\n        // Получаем части данных\r\n        res.on('data', (chunk) => {\r\n            data += chunk;\r\n        });\r\n\r\n        // Весь ответ получен\r\n        res.on('end', () => {\r\n            console.log('end ->>');\r\n            //console.log(extractFactObject(data));\r\n            //const resObj = (data);\r\n            // const nn =  data.replace('/_Incapsula', 'https://www.dtek-kem.com.ua/_Incapsula')\r\n            deferred.resolve(data);\r\n        });\r\n\r\n    }).on('error', (err) => {\r\n        console.log('Ошибка: ' + err.message);\r\n        deferred.reject(err.message);\r\n    });\r\n\r\n    return deferred.promise\r\n}"],"names":[],"sourceRoot":""}